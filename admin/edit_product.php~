<?php
require 'auth.php';
require '../bd.php';

$pdo = getBD();

$id = (int)$_GET['id'];

$stmt = $pdo->prepare("SELECT * FROM articles WHERE id_art = ?");
$stmt->execute([$id]);
$product = $stmt->fetch(PDO::FETCH_ASSOC);

if(!$product){
    header("Location: manage_products.php");
    exit();
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    $nom = trim($_POST['nom']);
    $prix = (float)$_POST['prix'];
    $quantite = (int)$_POST['quantite'];
    $url_photo = trim($_POST['url_photo']);
    $description = trim($_POST['description']);
    $categorie = trim($_POST['categorie']);

    $update = $pdo->prepare("
        UPDATE articles
        SET nom = ?, prix = ?, quantite = ?, url_photo = ?, description = ?, categorie = ?
        WHERE id_art = ?
    ");

    $update->execute([
        $nom,
        $prix,
        $quantite,
        $url_photo,
        $description,
        $categorie,
        $id
    ]);

    header("Location: manage_products.php");
    exit();
}

function e($v){ return htmlspecialchars((string)$v, ENT_QUOTES, 'UTF-8'); }
?>

<h1>✏ Modifier Produit</h1>

<form method="POST">

Nom:<br>
<input type="text" name="nom" value="<?= e($product['nom']) ?>"><br><br>

Catégorie:<br>
<input type="text" name="categorie" value="<?= e($product['categorie']) ?>"><br><br>

Prix:<br>
<input type="number" step="0.01" name="prix" value="<?= e($product['prix']) ?>"><br><br>

Quantité:<br>
<input type="number" name="quantite" value="<?= e($product['quantite']) ?>"><br><br>

URL Image:<br>
<input type="text" name="url_photo" value="<?= e($product['url_photo']) ?>"><br><br>

Description:<br>
<textarea name="description"><?= e($product['description']) ?></textarea><br><br>

<button type="submit">Mettre à jour</button>

</form>

<p><a href="manage_products.php">← Retour</a></p>