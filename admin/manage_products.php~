<?php
require 'auth.php';
require '../bd.php';

$pdo = getBD();

$stmt = $pdo->query("
    SELECT id_art, nom, quantite, prix, url_photo, description, categorie
    FROM articles
    ORDER BY id_art DESC
");

$products = $stmt->fetchAll(PDO::FETCH_ASSOC);

function e($v){ return htmlspecialchars((string)$v, ENT_QUOTES, 'UTF-8'); }
?>

<h1>âš™ Admin â€” Gestion des Produits</h1>
<a href="orders.php">ğŸ“¦ Voir les commandes</a>
<p>
<a href="../index.php">ğŸª Retour au magasin</a>
</p>

<p><a href="add_product.php">â• Ajouter un produit</a></p>

<table border="1" cellpadding="10">
<tr>
  <th>ID</th>
  <th>Nom</th>
  <th>CatÃ©gorie</th>
  <th>Prix</th>
  <th>Stock</th>
  <th>Image</th>
  <th>Actions</th>
</tr>

<?php foreach($products as $p): ?>
<tr>
  <td><?= (int)$p['id_art'] ?></td>
  <td><?= e($p['nom']) ?></td>
  <td><?= e($p['categorie']) ?></td>
  <td><?= number_format((float)$p['prix'], 2, ',', ' ') ?> â‚¬</td>
  <td><?= (int)$p['quantite'] ?></td>
  <td>
    <?php if($p['url_photo']): ?>
      <img src="../<?= e($p['url_photo']) ?>" width="60">
    <?php endif; ?>
  </td>
  <td>
     <a href="edit_product.php?id=<?= (int)$p['id_art'] ?>">Modifier</a> |
     <a href="delete_product.php?id=<?= (int)$p['id_art'] ?>"
        onclick="return confirm('Supprimer ce produit ?');">Supprimer</a>
  </td>
</tr>
<?php endforeach; ?>

</table>